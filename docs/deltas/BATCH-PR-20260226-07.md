## Delta 2026-02-26 (BATCH-PR-20260226-07): Session-Boundary Write Safety + Non-Blocking/Log-Storm Controls

### P0 - Stale outbound bytes can leak across reconnect session boundaries
- Problem description: `TcpTransport::close()` can preserve unsent bytes in `WriteBuffer`, allowing stale actions from a prior AMI session to flush after reconnect.
- Dialer impact: Replayed stale actions can execute on PBX without matching live correlation state, causing untracked side effects and operational drift.
- Required invariant: On non-graceful disconnect, outbound bytes from the prior session are never emitted after reconnect.
- Concrete implementation direction: Add explicit close semantics that distinguish graceful vs non-graceful shutdown; clear or epoch-invalidate `WriteBuffer` on non-graceful close before any reconnect write-ready flush.
- Tasks: PR7-P0-01

### P1 - Tick-path logging must not perform synchronous stdout I/O
- Problem description: Tick-path logging currently performs direct synchronous `echo` output.
- Dialer impact: Slow log consumers can block tick progression and violate non-blocking runtime guarantees.
- Required invariant: Tick-path logging is non-blocking and bounded under sink backpressure.
- Concrete implementation direction: Replace direct stdout writes with a bounded logger sink/queue abstraction; log-drop behavior and counters must be deterministic when sink capacity is exceeded.
- Tasks: PR7-P1-01

### P1 - Per-drop warning logs create amplification storms under queue pressure
- Problem description: Event-drop warnings are emitted per dropped event.
- Dialer impact: Log amplification can consume tick budget and delay protocol/correlation processing during bursts.
- Required invariant: Drop telemetry is rate-limited/coalesced while preserving accurate dropped-event counters.
- Concrete implementation direction: Add interval-based drop summary logging (`dropped_delta`, queue depth, server key) and enforce a fixed maximum warning rate per interval.
- Tasks: PR7-P1-02

### P1 - Laravel listener loop busy-spins without blocking/yield
- Problem description: `ami:listen` uses a tight `while (true)` loop with repeated poll calls and no bounded wait/yield.
- Dialer impact: Worker can pin CPU and degrade host stability in multi-tenant dialer environments.
- Required invariant: Laravel worker loop must use bounded blocking tick or controlled yield when idle.
- Concrete implementation direction: Update listen loop to call `tickAll()`/`tick()` with a bounded timeout (for example 10-50ms) or deterministic idle sleep; expose loop cadence as config/option.
- Tasks: PR7-P1-03

### P2 - Non-blocking runtime contract is not enforced at API boundary
- Problem description: Public APIs allow blocking timeouts (`timeoutMs > 0`) in runtime-critical paths.
- Dialer impact: Production loops can accidentally enter blocking select behavior and violate scheduling/fairness assumptions.
- Required invariant: Production runtime APIs are explicitly non-blocking by default and reject/segregate blocking mode.
- Concrete implementation direction: Clamp runtime loop paths to non-blocking timeout (`0`) or split APIs into explicit non-blocking vs blocking variants with clear contracts and validation.
- Tasks: PR7-P2-01

New/Updated Invariants:
- Non-graceful disconnect must purge or invalidate unsent outbound bytes before reconnect flush.
- Tick-path logging must be non-blocking and bounded under backpressure.
- Event-drop telemetry must be coalesced/rate-limited with deterministic counters.
- Laravel listen loop must not busy-spin.
- Production runtime path must enforce explicit non-blocking timeout semantics.