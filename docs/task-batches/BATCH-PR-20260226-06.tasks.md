## Append: BATCH-PR-20260226-06

### Phase P0 (Blockers)
None.

### Phase P1 (High)
None.

### Phase P2 (Medium)
- [x] PR6-P2-01 (BATCH-PR-20260226-06) Add non-silent fallback reporting when callback exception handler is missing
  Severity: P2
  Plan ref: Delta 2026-02-26 (BATCH-PR-20260226-06) -> P2 - PendingAction callback exception reporting can be silent
  Target files/classes: `src/Correlation/PendingAction.php`, `src/Core/Contracts/MetricsCollectorInterface.php`, `src/Core/Logger.php`
  Acceptance criteria:
- When completion callback throws and callback exception handler is null, a deterministic fallback signal is emitted (structured log and/or metric increment).
- Fallback signal includes `server_key` (when available), `action_id`, and callback exception class.
- No exception from fallback reporting escapes into tick/correlation flow.
  Required tests to add:
- PHPUnit unit test: callback throws + no handler -> fallback telemetry emitted and execution continues. Run with `vendor/bin/phpunit`.
  Invariants that must remain true:
- Callback exception handling is never silent.
- Listener/callback exceptions cannot break dispatch loops.

- [x] PR6-P2-02 (BATCH-PR-20260226-06) Isolate callback exception handler failures and preserve connection health
  Severity: P2
  Plan ref: Delta 2026-02-26 (BATCH-PR-20260226-06) -> P2 - PendingAction callback exception reporting can be silent
  Target files/classes: `src/Correlation/PendingAction.php`, `tests/Unit/Core/*`, `tests/Integration/*`
  Acceptance criteria:
- If callback exception handler throws, handler failure is captured by fallback telemetry path instead of being swallowed.
- Connection/tick processing continues after callback + handler failure.
- Subsequent actions/events complete successfully after the failure scenario.
  Required tests to add:
- PHPUnit integration test: callback throws, handler throws, connection remains healthy and next action completes. Run with `vendor/bin/phpunit`.
  Invariants that must remain true:
- Callback exceptions and callback-handler failures are observable and isolated.

- [x] PR6-P2-03 (BATCH-PR-20260226-06) Enforce parser constructor invariant between `bufferCap` and `maxFrameSize`
  Severity: P2
  Plan ref: Delta 2026-02-26 (BATCH-PR-20260226-06) -> P2 - Parser buffer cap can be set below frame-size requirements
  Target files/classes: `src/Protocol/Parser.php`, `src/Exceptions/InvalidConfigurationException.php`
  Acceptance criteria:
- Parser constructor validates that `bufferCap` is not smaller than `maxFrameSize` plus framing delimiter bytes.
- Invalid parser size relationships fail fast with typed `InvalidConfigurationException`.
- Validation message includes both configured values to support deterministic diagnosis.
  Required tests to add:
- PHPUnit unit test: constructor with `bufferCap < maxFrameSize + delimiter` throws `InvalidConfigurationException`. Run with `vendor/bin/phpunit`.
  Invariants that must remain true:
- Parser configuration cannot accept relationships that desync valid frames before frame-size checks.

- [x] PR6-P2-04 (BATCH-PR-20260226-06) Add parser misconfiguration regression tests to prevent desync churn
  Severity: P2
  Plan ref: Delta 2026-02-26 (BATCH-PR-20260226-06) -> P2 - Parser buffer cap can be set below frame-size requirements
  Target files/classes: `tests/Unit/Protocol/ParserTest.php`, `tests/Unit/Protocol/ParserHardeningTest.php`, `src/Protocol/Parser.php`
  Acceptance criteria:
- Tests prove invalid size relationship fails at construction and does not enter runtime parse path.
- Tests verify valid large-frame configuration still parses bounded frames without forced desync.
- Tests verify parser delimiter overhead is accounted for in accepted configuration.
  Required tests to add:
- PHPUnit unit test: valid boundary case (`bufferCap == maxFrameSize + delimiter`) is accepted.
- PHPUnit unit test: invalid relationship rejects configuration before parsing begins. Run with `vendor/bin/phpunit`.
  Invariants that must remain true:
- Parser settings remain bounded and deterministic under dialer-sized frames.

### Phase P3 (Low)
None.
