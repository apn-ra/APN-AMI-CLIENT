## Append: BATCH-PR-20260226-05

### Phase P0 (Blockers)
None.

### Phase P1 (High)
- [x] PR5-P1-01 (BATCH-PR-20260226-05) Remove transport/reactor error suppression and emit structured errors
  Severity: P1
  Target files/classes: `src/Transport/TcpTransport.php`, `src/Transport/Reactor.php`
  Acceptance criteria:
- No `@` suppression remains on socket/selector operations in transport/reactor code paths.
- On `stream_select`/read/write/connect failure, native error details are captured and logged with `server_key` and operation.
- Transport failure triggers controlled close/retry and increments a transport error metric counter.
  Required tests to add:
- PHPUnit integration test: selector failure on a closed socket emits structured warning and schedules reconnect; metric counter increments. Run with `vendor/bin/phpunit`.
- PHPUnit unit test: `TcpTransport::read()` failure logs error details and does not suppress errors. Run with `vendor/bin/phpunit`.
  Invariants that must remain true:
- Transport/selector errors are observable and never silently suppressed.

- [x] PR5-P1-02 (BATCH-PR-20260226-05) Make `Logger::log()` non-throwing and preserve listener isolation
  Severity: P1
  Target files/classes: `src/Core/Logger.php`, `src/Core/AmiClient.php`
  Acceptance criteria:
- `Logger::log()` never throws, even when serialization fails due to malformed UTF-8 or invalid context.
- A minimal plain-text fallback line is emitted when JSON encoding fails.
- Listener exception handling continues dispatch even if logger serialization fails.
  Required tests to add:
- PHPUnit unit test: malformed UTF-8 context does not throw and uses fallback output. Run with `vendor/bin/phpunit`.
- PHPUnit test: listener throws and logger serialization fails; connection remains healthy and subsequent event is dispatched. Run with `vendor/bin/phpunit`.
  Invariants that must remain true:
- Listener exceptions cannot break dispatch loops.

### Phase P2 (Medium)
- [x] PR5-P2-01 (BATCH-PR-20260226-05) Validate redaction regex patterns and fail fast
  Severity: P2
  Target files/classes: `src/Core/SecretRedactor.php`, `src/Core/ClientOptions.php`, `src/Exceptions/InvalidConfigurationException.php`
  Acceptance criteria:
- Redaction regex patterns are validated at construction; invalid patterns throw `InvalidConfigurationException`.
- No `@preg_*` suppression remains in redaction logic.
- Invalid pattern detection is logged/metriced deterministically.
  Required tests to add:
- PHPUnit unit test: invalid regex in redaction config throws `InvalidConfigurationException`. Run with `vendor/bin/phpunit`.
  Invariants that must remain true:
- Redaction must not be silently disabled by invalid patterns.

- [x] PR5-P2-02 (BATCH-PR-20260226-05) Move hostname resolution out of manager runtime path
  Severity: P2
  Target files/classes: `src/Cluster/AmiClientManager.php`, `config/*`
  Acceptance criteria:
- `gethostbyname()` is not used in manager runtime/tick paths.
- Hostname mode requires pre-resolved IPs or an injected resolver outside runtime-critical paths.
- Startup/tick paths remain non-blocking under hostname configurations.
  Required tests to add:
- PHPUnit unit test: hostname configuration without pre-resolved IPs fails fast or requires resolver injection. Run with `vendor/bin/phpunit`.
- PHPUnit integration test: deterministic non-blocking verification under hostname configuration (tick continues while hostname resolution is external). Run with `vendor/bin/phpunit`.
  Invariants that must remain true:
- No blocking DNS resolution in runtime-critical paths.

- [x] PR5-P2-03 (BATCH-PR-20260226-05) Replace signal handler `exit(0)` with application hook
  Severity: P2
  Target files/classes: `src/Cluster/AmiClientManager.php`
  Acceptance criteria:
- Signal handler invokes a callback/event hook and returns without terminating the process.
- Default library behavior does not call `exit()`.
- Host application owns shutdown semantics.
  Required tests to add:
- PHPUnit unit test: signal handler triggers hook and does not terminate the process. Run with `vendor/bin/phpunit`.
  Invariants that must remain true:
- Library code must not terminate the host process.

### Phase P3 (Low)
None.