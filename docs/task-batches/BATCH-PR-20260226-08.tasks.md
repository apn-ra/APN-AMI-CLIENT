## Append: BATCH-PR-20260226-08

### Phase P0 (Blockers)
None.

### Phase P1 (High)
- [x] PR8-P1-01 (BATCH-PR-20260226-08) Enforce always-non-blocking runtime timeouts
  Severity: P1
  Target files/classes: `src/Cluster/AmiClientManager.php`, `src/Transport/Reactor.php`, `src/Transport/TcpTransport.php`
  Plan ref: Delta 2026-02-26 (BATCH-PR-20260226-08) -> P1 - Tick loop non-blocking invariant is not enforced
  Acceptance criteria:
- Production runtime paths clamp or reject any non-zero timeout inputs and always return `0` for runtime select timeouts.
- Blocking opt-out flags are removed from production paths or isolated into explicit dev/test-only components.
- Non-blocking behavior is documented and enforced consistently across manager/reactor/transport.
  Required tests to add:
- PHPUnit unit test: non-blocking invariant fails if any production `normalizeTimeoutMs()` or equivalent returns non-zero. Run with `vendor/bin/phpunit`.
- PHPUnit integration test: tick loop remains non-blocking across multiple nodes even when caller passes non-zero timeout. Run with `vendor/bin/phpunit`.
  Invariants that must remain true:
- Tick loop is fully non-blocking in production runtime paths.
- Multi-server fairness under per-tick budgets remains intact.

### Phase P2 (Medium)
- [x] PR8-P2-01 (BATCH-PR-20260226-08) Record read-timeout failures in circuit breaker
  Severity: P2
  Target files/classes: `src/Health/ConnectionManager.php`
  Plan ref: Delta 2026-02-26 (BATCH-PR-20260226-08) -> P2 - Read-timeout failures are not recorded in circuit breaker
  Acceptance criteria:
- `recordReadTimeout()` records `recordCircuitFailure('read_timeout')` before scheduling reconnect.
- Circuit-breaker transition logging/metrics are consistent with connect/auth failure paths.
  Required tests to add:
- PHPUnit unit test: repeated read timeouts transition circuit breaker to open/half-open per policy. Run with `vendor/bin/phpunit`.
  Invariants that must remain true:
- Reconnect storms cannot monopolize tick time.

- [x] PR8-P2-02 (BATCH-PR-20260226-08) Emit structured, throttled warnings on logger sink drops
  Severity: P2
  Target files/classes: `src/Core/Logger.php`, `src/Core/AmiClient.php`
  Plan ref: Delta 2026-02-26 (BATCH-PR-20260226-08) -> P2 - Logger sink drops lack structured warning logs
  Acceptance criteria:
- Sink drop reasons (`capacity_exceeded`, `sink_exception`, `sink_write_failed`) emit structured warnings with `server_key`, `queue_depth`, and reason.
- Drop counters continue to increment deterministically for each drop condition.
- Warning logs are throttled to avoid log amplification storms.
  Required tests to add:
- PHPUnit unit test: sink drop increments counter and emits one throttled warning with required fields. Run with `vendor/bin/phpunit`.
- PHPUnit unit test: metrics/logging wiring remains intact when sink throws (logger remains non-throwing). Run with `vendor/bin/phpunit`.
  Invariants that must remain true:
- Logger sink drops are observable (logged and counted).
- Logger must never throw and must not block tick progression.

### Phase P3 (Low)
- [x] PR8-P3-01 (BATCH-PR-20260226-08) Replace logger sink queue with O(1) dequeue structure
  Severity: P3
  Target files/classes: `src/Core/Logger.php`
  Plan ref: Delta 2026-02-26 (BATCH-PR-20260226-08) -> P3 - Logger sink queue uses O(n) dequeue
  Acceptance criteria:
- Sink queue uses `SplQueue` (or equivalent) to avoid O(n) dequeue reindexing.
- Queue order is preserved under sustained logging.
  Required tests to add:
- PHPUnit unit test: queued log entries preserve FIFO order after multiple enqueues/dequeues. Run with `vendor/bin/phpunit`.
  Invariants that must remain true:
- Logger sink queue remains bounded.

- [x] PR8-P3-02 (BATCH-PR-20260226-08) Route PendingAction fallback telemetry through PSR-3 logger
  Severity: P3
  Target files/classes: `src/Correlation/PendingAction.php`, `src/Correlation/CorrelationRegistry.php`
  Plan ref: Delta 2026-02-26 (BATCH-PR-20260226-08) -> P3 - PendingAction fallback telemetry bypasses PSR-3 logger
  Acceptance criteria:
- Fallback exception telemetry uses PSR-3 logger path instead of `error_log`.
- Structured context is preserved and redaction policies remain intact.
  Required tests to add:
- PHPUnit unit test: callback exception with missing handler emits PSR-3 log entry with required context. Run with `vendor/bin/phpunit`.
  Invariants that must remain true:
- Listener exceptions cannot break dispatch loops.