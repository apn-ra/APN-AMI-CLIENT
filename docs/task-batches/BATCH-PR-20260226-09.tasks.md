## Append: BATCH-PR-20260226-09

### Phase P0 (Blockers)
None.

### Phase P1 (High)
- [x] PR9-P1-01 (BATCH-PR-20260226-09) Implement bounded worker cadence for `ami:listen` loop
  Severity: P1
  Plan ref: Delta 2026-02-26 (BATCH-PR-20260226-09) -> P1 - Worker cadence controls are effectively disabled (hot-spin risk)
  Target files/classes: `src/Laravel/Commands/ListenCommand.php`, `src/Cluster/AmiClientManager.php`, `src/Transport/Reactor.php`, `config/ami-client.php`
  Acceptance criteria:
- `ami:listen` loop honors a bounded cadence (timeout or idle-yield) with production-safe defaults.
- Cadence configuration is validated at startup and rejects invalid values with a typed exception.
- Idle loop no longer hot-spins in no-event conditions.
  Required tests to add:
- PHPUnit integration test: idle listen loop executes bounded iterations with configured cadence and does not hot-spin. Run with `vendor/bin/phpunit`.
- PHPUnit unit test: invalid cadence configuration is rejected deterministically. Run with `vendor/bin/phpunit`.
  Invariants that must remain true:
- Core remains framework-agnostic (no `Illuminate\*` outside `src/Laravel/`).
- Tick loop remains non-blocking in production runtime paths.

### Phase P2 (Medium)
- [x] PR9-P2-01 (BATCH-PR-20260226-09) Align `timeoutMs` contract across public APIs and runtime behavior
  Severity: P2
  Plan ref: Delta 2026-02-26 (BATCH-PR-20260226-09) -> P2 - `timeoutMs` API contract is misleading (ignored end-to-end)
  Target files/classes: `src/Core/Contracts/AmiClientInterface.php`, `src/Core/Contracts/TransportInterface.php`, `src/Cluster/AmiClientManager.php`, `src/Transport/Reactor.php`, `src/Laravel/Commands/ListenCommand.php`
  Acceptance criteria:
- Chosen timeout contract is enforced end-to-end (either honored where safe or explicitly rejected/clamped everywhere).
- Public interface signatures and documentation match runtime behavior.
- Runtime behavior is deterministic for `timeoutMs` inputs (no silent ignores).
  Required tests to add:
- PHPUnit unit test: `tick(timeoutMs)` behavior matches the declared contract across manager/reactor/transport. Run with `vendor/bin/phpunit`.
- PHPUnit integration test: caller-supplied `timeoutMs` produces the expected runtime behavior across multiple nodes. Run with `vendor/bin/phpunit`.
  Invariants that must remain true:
- Tick loop fully non-blocking in production runtime paths.
- Multi-server fairness under per-tick budgets remains intact.

- [x] PR9-P2-02 (BATCH-PR-20260226-09) Add hostname resolver injection support to `ConfigLoader`
  Severity: P2
  Plan ref: Delta 2026-02-26 (BATCH-PR-20260226-09) -> P2 - ConfigLoader cannot inject hostname resolver for non-IP endpoints
  Target files/classes: `src/Cluster/ConfigLoader.php`, `src/Cluster/AmiClientManager.php`, `tests/Integration/*`
  Acceptance criteria:
- `ConfigLoader::load()` accepts a hostname resolver (or pre-resolved hostnames) when `enforce_ip_endpoints` is disabled.
- Hostname-based endpoints are bootstrapped successfully without manual manager wiring.
- Resolver behavior is deterministic and does not perform blocking DNS in tick paths.
  Required tests to add:
- PHPUnit integration test: hostname endpoint bootstraps via injected resolver and connects as expected. Run with `vendor/bin/phpunit`.
- PHPUnit unit test: hostname endpoint without resolver fails fast with typed configuration exception when required. Run with `vendor/bin/phpunit`.
  Invariants that must remain true:
- Non-blocking runtime paths do not perform DNS resolution inside tick/reconnect.
- Configuration validation remains deterministic and typed.

- [x] PR9-P2-03 (BATCH-PR-20260226-09) Validate critical numeric option ranges in `ClientOptions`
  Severity: P2
  Plan ref: Delta 2026-02-26 (BATCH-PR-20260226-09) -> P2 - Numeric option ranges are not validated at load time
  Target files/classes: `src/Cluster/ClientOptions.php`, `src/Health/ConnectionManager.php`, `src/Exceptions/InvalidConfigurationException.php`
  Acceptance criteria:
- All critical numeric options (timeouts, reconnect attempts, queue/buffer limits) are range-validated at construction time.
- Invalid values fail fast with `InvalidConfigurationException` and include the offending key/value in the message.
- Validation is centralized and reused by dependent constructors where applicable.
  Required tests to add:
- PHPUnit unit test matrix: zero/negative/out-of-range values throw `InvalidConfigurationException` with deterministic messages. Run with `vendor/bin/phpunit`.
- PHPUnit unit test: valid boundary values are accepted without side effects. Run with `vendor/bin/phpunit`.
  Invariants that must remain true:
- Memory safety caps remain enforced and bounded.
- Reconnect storm protections remain intact under valid configuration.

### Phase P3 (Low)
- [x] PR9-P3-01 (BATCH-PR-20260226-09) Make `enforceIpEndpoints` behavior explicit and consistent in `TcpTransport`
  Severity: P3
  Plan ref: Delta 2026-02-26 (BATCH-PR-20260226-09) -> P3 - `enforceIpEndpoints` flag does not change transport behavior
  Target files/classes: `src/Transport/TcpTransport.php`, `src/Cluster/ClientOptions.php`, `tests/Unit/Transport/*`
  Acceptance criteria:
- Transport behavior matches configuration: either enforce IP-only everywhere or permit hostnames when `enforceIpEndpoints` is disabled.
- Configuration ambiguity is removed and behavior is documented in code comments where necessary.
- Endpoint validation paths are covered by deterministic tests.
  Required tests to add:
- PHPUnit unit test: hostname endpoint behavior matches `enforceIpEndpoints` configuration. Run with `vendor/bin/phpunit`.
  Invariants that must remain true:
- Transport endpoint policy is deterministic and consistent across code paths.